import datetime
import os
import pickle
import sys
from google.oauth2.credentials import Credentials
from google_auth_oauthlib.flow import InstalledAppFlow
from google.auth.transport.requests import Request
from googleapiclient.discovery import build

# If modifying these SCOPES, delete the file token.pickle.
SCOPES = ['https://www.googleapis.com/auth/calendar']

def authenticate_google_calendar():
    creds = None
    if os.path.exists('token.pickle'):
        with open('token.pickle', 'rb') as token:
            creds = pickle.load(token)
    if not creds or not creds.valid:
        if creds and creds.expired and creds.refresh_token:
            creds.refresh(Request())
        else:
            flow = InstalledAppFlow.from_client_secrets_file(
                'credentials.json', SCOPES)
            creds = flow.run_local_server(port=0)
        with open('token.pickle', 'wb') as token:
            pickle.dump(creds, token)
    service = build('calendar', 'v3', credentials=creds)
    return service

def create_event(service, summary, start_date, start_time, end_time, recurrence, calendar_id):
    start_datetime = f'{start_date}T{start_time}:00'
    end_datetime = f'{start_date}T{end_time}:00'
    
    event = {
        'summary': summary,
        'start': {
            'dateTime': start_datetime,
            'timeZone': 'America/New_York',  # Change to your timezone
        },
        'end': {
            'dateTime': end_datetime,
            'timeZone': 'America/New_York',  # Change to your timezone
        },
        'recurrence': recurrence,
    }

    event = service.events().insert(calendarId=calendar_id, body=event).execute()
    print(f'Event created: {event.get("htmlLink")}')

def main():
    service = authenticate_google_calendar()
    
    # Replace 'your_calendar_id@group.calendar.google.com' with your Calendar ID
    calendar_id = '4917f866727cb760e5cb2ba48301b6ef747de9e13c03a8d430d1d661a60b0a7c@group.calendar.google.com'

    # Example class schedules
    classes = [
        #Geometry        
        {
            'name': 'Geometry D103',
            'days': ['MO'],  # MO for Monday
            'start_time': '07:20',
            'end_time': '08:15',
            'date_ranges': [
                ('2024-09-16', '2024-09-21'),
                ('2024-10-07', '2024-10-16'),
                ('2024-11-04', '2024-11-09'),
                ('2024-12-02', '2024-12-18'),
                ('2025-01-20', '2025-02-01'),
                ('2025-02-24', '2025-03-08'),
                ('2025-03-31', '2025-04-05'),
                ('2025-04-28', '2025-05-07'),
                ('2025-05-19', '2025-05-29'),
                ('2025-06-09', '2025-06-17'),
            ],
        },{
            'name': 'Geometry D103',
            'days': ['MO', 'TU', 'WE', 'TH', 'FR'],  # MO for Monday
            'start_time': '12:20',
            'end_time': '13:10',
            'date_ranges': [
                ('2024-09-10', '2024-09-21'),
                ('2024-10-03', '2024-10-16'),
                ('2024-10-29', '2024-11-09'),
                ('2024-12-02', '2024-12-18'),
                ('2025-01-14', '2025-02-01'),
                ('2025-02-21', '2025-03-08'),
                ('2025-03-25', '2025-04-05'),
                ('2025-04-24', '2025-05-07'),
                ('2025-05-19', '2025-05-29'),
                ('2025-06-09', '2025-06-17'),
            ],
        },

        #English
        {
            'name': 'English D215',
            'days': ['TU'],  # MO for Monday
            'start_time': '07:20',
            'end_time': '08:15',
            'date_ranges': [
                ('2024-09-10', '2024-09-21'),
                ('2024-10-08', '2024-10-16'),
                ('2024-10-29', '2024-11-09'),
                ('2024-12-03', '2024-12-18'),
                ('2025-01-14', '2025-02-01'),
                ('2025-02-25', '2025-03-08'),
                ('2025-03-25', '2025-04-05'),
                ('2025-04-29', '2025-05-07'),
                ('2025-05-20', '2025-05-29'),
                ('2025-06-10', '2025-06-17'),
            ],
        },{
            'name': 'English D215',
            'days': ['MO', 'TU', 'WE', 'TH', 'FR'],  # MO for Monday
            'start_time': '08:20',
            'end_time': '09:10',
            'date_ranges': [
                ('2024-09-10', '2024-09-21'),
                ('2024-10-03', '2024-10-16'),
                ('2024-10-29', '2024-11-09'),
                ('2024-12-02', '2024-12-18'),
                ('2025-01-14', '2025-02-01'),
                ('2025-02-21', '2025-03-08'),
                ('2025-03-25', '2025-04-05'),
                ('2025-04-24', '2025-05-07'),
                ('2025-05-19', '2025-05-29'),
                ('2025-06-09', '2025-06-17'),
            ],
        },

        #Biology
        {
            'name': 'Biology I D105',
            'days': ['WE'],  # MO for Monday
            'start_time': '07:20',
            'end_time': '08:15',
            'date_ranges': [
                ('2024-09-11', '2024-09-21'),
                ('2024-10-09', '2024-10-16'),
                ('2024-10-30', '2024-11-09'),
                ('2024-12-04', '2024-12-18'),
                ('2025-01-15', '2025-02-01'),
                ('2025-02-26', '2025-03-08'),
                ('2025-03-26', '2025-04-05'),
                ('2025-04-30', '2025-05-07'),
                ('2025-05-21', '2025-05-29'),
                ('2025-06-11', '2025-06-17'),

            ],
        },{
            'name': 'Biology I D105',
            'days': ['MO', 'TU', 'WE', 'TH', 'FR'],  # MO for Monday
            'start_time': '13:15',
            'end_time': '14:05',
            'date_ranges': [
                ('2024-09-10', '2024-09-21'),
                ('2024-10-03', '2024-10-16'),
                ('2024-10-29', '2024-11-09'),
                ('2024-12-02', '2024-12-18'),
                ('2025-01-14', '2025-02-01'),
                ('2025-02-21', '2025-03-08'),
                ('2025-03-25', '2025-04-05'),
                ('2025-04-24', '2025-05-07'),
                ('2025-05-19', '2025-05-29'),
                ('2025-06-09', '2025-06-17'),
            ],
        },

        #History
        {
            'name': 'Civics/American Government D124',
            'days': ['FR'],  # MO for Monday
            'start_time': '07:20',
            'end_time': '08:15',
            'date_ranges': [
                ('2024-09-13', '2024-09-21'),
                ('2024-10-04', '2024-10-16'),
                ('2024-11-01', '2024-11-09'),
                ('2024-12-06', '2024-12-18'),
                ('2025-01-17', '2025-02-01'),
                ('2025-02-21', '2025-03-08'),
                ('2025-03-28', '2025-04-05'),
                ('2025-04-25', '2025-05-07'),
                ('2025-05-23', '2025-05-29'),
                ('2025-06-13', '2025-06-17'),
            ],
        },{
            'name': 'Civics/American Government D124',
            'days': ['MO', 'TU', 'WE', 'TH', 'FR'],  # MO for Monday
            'start_time': '10:05',
            'end_time': '10:55',
            'date_ranges': [
                ('2024-09-10', '2024-09-21'),
                ('2024-10-03', '2024-10-16'),
                ('2024-10-29', '2024-11-09'),
                ('2024-12-02', '2024-12-18'),
                ('2025-01-14', '2025-02-01'),
                ('2025-02-21', '2025-03-08'),
                ('2025-03-25', '2025-04-05'),
                ('2025-04-24', '2025-05-07'),
                ('2025-05-19', '2025-05-29'),
                ('2025-06-09', '2025-06-17'),
            ],
        },

        #Gym
        {
            'name': 'Gym',
            'days': ['MO', 'TU'],  # MO for Monday
            'start_time': '10:55',
            'end_time': '12:20',
            'date_ranges': [
                ('2024-09-10', '2024-09-21'),
                ('2024-10-07', '2024-10-16'),
                ('2024-10-29', '2024-11-09'),
                ('2024-12-02', '2024-12-18'),
                ('2025-01-14', '2025-02-01'),
                ('2025-02-24', '2025-03-08'),
                ('2025-03-25', '2025-04-05'),
                ('2025-04-28', '2025-05-07'),
                ('2025-05-19', '2025-05-29'),
                ('2025-06-09', '2025-06-17'),
            ],
        },

        #Health
        {
            'name': 'Health II C202',
            'days': ['TH', 'FR'],  # MO for Monday
            'start_time': '10:55',
            'end_time': '12:20',
            'date_ranges': [
                ('2024-09-12', '2024-09-21'),
                ('2024-10-03', '2024-10-16'),
                ('2024-10-31', '2024-11-09'),
                ('2024-12-05', '2024-12-18'),
                ('2025-01-16', '2025-02-01'),
                ('2025-02-21', '2025-03-08'),
                ('2025-03-27', '2025-04-05'),
                ('2025-04-24', '2025-05-07'),
                ('2025-05-22', '2025-05-29'),
                ('2025-06-12', '2025-06-17'),
            ],
        },

        #Art
        {
            'name': '2D Design B202',
            'days': ['TU', 'WE', 'FR'],  # MO for Monday
            'start_time': '09:10',
            'end_time': '10:00',
            'date_ranges': [
                ('2024-09-10', '2024-09-21'),
                ('2024-10-04', '2024-10-16'),
                ('2024-10-29', '2024-11-09'),
                ('2024-12-03', '2024-12-18'),
                ('2025-01-14', '2025-02-01'),
                ('2025-02-21', '2025-03-08'),
                ('2025-03-25', '2025-04-05'),
                ('2025-04-25', '2025-05-07'),
                ('2025-05-20', '2025-05-29'),
                ('2025-06-10', '2025-06-17'),
            ],
        },

        #Access
        {
            'name': 'Academic Access C205',
            'days': ['MO'],  # MO for Monday
            'start_time': '09:10',
            'end_time': '10:00',
            'date_ranges': [
                ('2024-09-12', '2024-09-21'),
                ('2024-10-03', '2024-10-16'),
                ('2024-10-31', '2024-11-09'),
                ('2024-12-05', '2024-12-18'),
                ('2025-01-16', '2025-02-01'),
                ('2025-02-27', '2025-03-08'),
                ('2025-03-27', '2025-04-05'),
                ('2025-04-24', '2025-05-07'),
                ('2025-05-22', '2025-05-29'),
                ('2025-06-12', '2025-06-17'),            ],
        },{
            'name': 'Academic Access D105',
            'days': ['WE'],  # MO for Monday
            'start_time': '10:55',
            'end_time': '12:20',
            'date_ranges': [
                ('2024-09-12', '2024-09-21'),
                ('2024-10-03', '2024-10-16'),
                ('2024-10-31', '2024-11-09'),
                ('2024-12-05', '2024-12-18'),
                ('2025-01-16', '2025-02-01'),
                ('2025-02-27', '2025-03-08'),
                ('2025-03-27', '2025-04-05'),
                ('2025-04-24', '2025-05-07'),
                ('2025-05-22', '2025-05-29'),
                ('2025-06-12', '2025-06-17'),            ],
        },{
            'name': 'Academic Access D212',
            'days': ['TH'],  # MO for Monday
            'start_time': '07:20',
            'end_time': '08:15',
            'date_ranges': [
                ('2024-09-12', '2024-09-21'),
                ('2024-10-03', '2024-10-16'),
                ('2024-10-31', '2024-11-09'),
                ('2024-12-05', '2024-12-18'),
                ('2025-01-16', '2025-02-01'),
                ('2025-02-27', '2025-03-08'),
                ('2025-03-27', '2025-04-05'),
                ('2025-04-24', '2025-05-07'),
                ('2025-05-22', '2025-05-29'),
                ('2025-06-12', '2025-06-17'),            ],
        },{
            'name': 'Academic Access D202',
            'days': ['TH'],  # MO for Monday
            'start_time': '09:10',
            'end_time': '10:00',
            'date_ranges': [
                ('2024-09-12', '2024-09-21'),
                ('2024-10-03', '2024-10-16'),
                ('2024-10-31', '2024-11-09'),
                ('2024-12-05', '2024-12-18'),
                ('2025-01-16', '2025-02-01'),
                ('2025-02-27', '2025-03-08'),
                ('2025-03-27', '2025-04-05'),
                ('2025-04-24', '2025-05-07'),
                ('2025-05-22', '2025-05-29'),
                ('2025-06-12', '2025-06-17'),            ],
        },

        #IT
        {
            'name': 'Intermediate Software Applications',
            'days': ['MO', 'TU', 'WE', 'TH', 'FR'],  # MO for Monday
            'start_time': '07:20',
            'end_time': '12:20',
            'date_ranges': [
                ('2024-08-29', '2024-09-10'),
                ('2024-09-23', '2024-10-03'),
                ('2024-10-16', '2024-10-29'),
                ('2024-11-12', '2024-11-28'),
                ('2025-12-18', '2025-12-21'),
                ('2025-01-02', '2025-01-14'),
                ('2025-02-03', '2025-02-21'),
                ('2025-03-10', '2025-03-25'),
                ('2025-04-07', '2025-04-24'),
                ('2025-05-07', '2025-05-17'),
                ('2025-05-29', '2025-06-07'),
            ],
        },

        #Trade Classes
        {
            'name': 'English D215',
            'days': ['MO', 'TU', 'WE', 'TH', 'FR'],  # MO for Monday
            'start_time': '12:25',
            'end_time': '13:10',
            'date_ranges': [
                ('2024-08-29', '2024-09-10'),
                ('2024-09-23', '2024-10-03'),
                ('2024-10-16', '2024-10-29'),
                ('2024-11-12', '2024-11-28'),
                ('2025-12-18', '2025-12-21'),
                ('2025-01-02', '2025-01-14'),
                ('2025-02-03', '2025-02-21'),
                ('2025-03-10', '2025-03-25'),
                ('2025-04-07', '2025-04-24'),
                ('2025-05-07', '2025-05-17'),
                ('2025-05-29', '2025-06-07'),
            ],
        },{
            'name': 'Math E215',
            'days': ['MO', 'TU', 'WE', 'TH', 'FR'],  # MO for Monday
            'start_time': '13:15',
            'end_time': '14:05',
            'date_ranges': [
                ('2024-08-29', '2024-09-10'),
                ('2024-09-23', '2024-10-03'),
                ('2024-10-16', '2024-10-29'),
                ('2024-11-12', '2024-11-28'),
                ('2025-12-18', '2025-12-21'),
                ('2025-01-02', '2025-01-14'),
                ('2025-02-03', '2025-02-21'),
                ('2025-03-10', '2025-03-25'),
                ('2025-04-07', '2025-04-24'),
                ('2025-05-07', '2025-05-17'),
                ('2025-05-29', '2025-06-07'),
            ],
        },
        # Add more classes here
    ]

    for cls in classes:
        for start_date, end_date in cls['date_ranges']:
            create_event(
                service=service,
                summary=cls['name'],
                start_date=start_date,
                start_time=cls['start_time'],
                end_time=cls['end_time'],
                recurrence=[f'RRULE:FREQ=WEEKLY;BYDAY={",".join(cls["days"])};UNTIL={end_date.replace("-", "")}'],
                calendar_id=calendar_id
            )

if __name__ == '__main__':
    main()